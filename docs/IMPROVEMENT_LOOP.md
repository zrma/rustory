# Improvement Loop

- Audience: Rustory 유지보수자, LLM 에이전트
- Owner: Rustory
- Last Verified: 2026-02-19

이 문서는 반복 개발에서 누락/회귀를 줄이기 위한 경량 운영 루프를 정의한다.

## 목적

- 같은 실수를 반복하지 않도록 교훈을 작업 규칙으로 전환한다.
- 문서/스크립트/검증을 통해 재발 방지 장치를 누적한다.

## 트리거

- 합의된 작업 항목 누락
- 계획 스냅샷 없이 구현 착수
- 출고 직전 검증 실패
- 같은 유형의 재작업 2회 이상 발생
- 운영 장애/롤백 발생
- 문서 책임 경계가 흐려져 라우팅 문서와 규칙 소유 문서가 뒤섞인 경우

## 실행 게이트

- 기본 규칙: `Plan -> Act -> Verify -> Judge -> Learn` 순서를 지킨다.
- 선택지가 있는 논의 항목은 `Act` 전에 질문 카드로 먼저 정리한다.
  - 최소 필드: `description`, `options(2~3)`, `pros/cons`, `recommended`
  - 위치: 해당 작업의 `docs/todo-*/open-questions.md`
- `Act` 시작 전 필수 항목
  - 목표/범위
  - 완료 기준
  - 실행할 검증 명령
- 비긴급 구현 착수/종료 게이트, `work-id` 자동 감지/예외 규칙은 `docs/EXECUTION_LOOP.md`, `docs/CHANGE_CONTROL.md`를 단일 기준으로 따른다.
- 이 문서는 위 표준 실행 루프를 대체하지 않고, 실패/누락 시 `Judge -> Learn` 강화 규칙만 추가로 정의한다.
- 결정이 끝난 질문은 같은 턴에서 즉시 문서에 반영한다.
  - `spec.md`와 대상 문서를 갱신
  - `open-questions.md`에서 해당 항목을 닫음
  - 다음 주제로 넘어가기 전에 `완료/미완료/다음 액션` 체크포인트 기록
- 긴급 복구(hotfix)로 즉시 수정이 필요한 경우
  - 예외적으로 `Act`를 먼저 수행할 수 있다.
  - 단, 같은 턴에서 반드시 계획/근거/검증/교훈 기록으로 루프를 닫는다.

## 에이전트 실패 복구/중단 기준

- 게이트/검증 실패 시 우선 원인 분류 후 동일 명령 재시도는 최대 2회까지만 허용한다.
- 같은 게이트 실패가 2회 연속 반복되면 자동 재시도를 중단하고 `docs/ESCALATION_POLICY.md` 기준으로 즉시 에스컬레이션한다.
- 재시도 전에는 `spec.md`의 `완료/미완료/다음 액션`에 실패 사실과 다음 조치를 기록한다.
- `DEBUG_GATES_OVERRIDE`, `--allow-missing-work-id`, `ALLOW_NON_STRICT_PUSH_GATES` 같은 우회 경로는 사람 승인 없이 사용하지 않는다.
- 인증/권한/원격 접근 실패처럼 외부 시스템 원인이 의심되면 임의 우회 대신 상태를 보고하고 중단한다.

## 10분 회고 루프

1. 사실 기록: 무슨 일이 있었는지 3줄 이내로 정리
2. 원인 기록: 프로세스 원인 1줄로 정의
3. 방지책 결정: 문서/스크립트/검증 중 최소 1개 반영
4. 검증 증거: 실행 명령과 결과를 남김
5. 후속 액션: 담당/기한/상태를 명시

## 금지 패턴

- 논의가 끝난 뒤 장시간이 지난 후에 문서 템플릿/질문 카드를 사후 반영하는 방식
- 질문 해소 여부를 `open-questions.md`에 닫지 않은 채 다른 주제로 이동하는 방식
- `open-questions.md`에 `Resolved`/결정 이력을 남겨 질문 문서와 스펙 문서의 책임을 섞는 방식
- 완료된 `docs/todo-*`를 `docs/archive-*` 루트 폴더로 옮겨 장기 보관하는 방식 (완료 `todo`는 삭제하고 `docs/LESSONS_LOG.md` 또는 `docs/LESSONS_ARCHIVE.md`에만 식별자를 남긴다)
- 구현 요청 턴에서 `원하면 진행` 형태로 커밋/푸시를 다음 턴으로 미루는 방식

## 산출물

- 로그: `docs/LESSONS_LOG.md`
- 에스컬레이션 기준: `docs/ESCALATION_POLICY.md`
- 필요 시 갱신 문서: `AGENTS.md`, `docs/OPERATING_MODEL.md`, `docs/CHANGE_CONTROL.md`, 모듈 문서
- 필요 시 스크립트/검증: `scripts/` 또는 모듈 검증 스크립트
- 교훈 기록 기준: 자동화/강제 장치가 이미 있어도 반복 실패, 우회 시도, 예외 승인 사용이 발생한 항목은 `LESSONS_LOG`에 기록한다. 단순 정상 통과만 반복된 항목은 기록하지 않는다.
- 경로 표기 기준: `LESSONS_LOG`에 과거 `docs/todo-*` 경로를 증적 식별자로 남길 때는 "현재는 삭제될 수 있는 과거 경로"임을 명시하고, 재실행 대상은 현행 문서/스크립트 경로를 함께 적는다.

## 크기 관리 규칙

- `docs/LESSONS_LOG.md`는 최근 50개 항목까지 유지한다.
- 오래된 항목은 `docs/LESSONS_ARCHIVE.md`로 이동한다.
- 아카이브 이관 주기는 분기 1회로 권장한다.
- 항목 1개는 표 1행 + 필요한 경우 참고 링크 2개 이내로 유지한다.
